<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Global styles */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url(cakeBackground.jpg);
        }

        /* Styles for form container */
        .container {
            width: 100%;
            max-width: 400px; /* Set maximum width of the form container */
            margin: auto;
            padding: 20px;
        }

        /* Styles for form inputs */
        /* input[type=date], input[type=number], input[type=text], input[type=password] {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        } */

        /* Styles for submit button */
        input[type=submit], button {
            width: 100%;
            background-color: #4CAF50;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type=submit]:hover, button:hover {
            background-color: #45a049;
        }

        /* Styles for message div */
        #message {
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
        }

        /* Media query for smaller screens */
        @media screen and (max-width: 600px) {
            .container {
                padding: 10px;
            }
        }

        /* Styles for modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            color: green;
            width: 80%;
            max-width: 600px;
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #topBar {
            height: 60px;
            width: 100%; 
        }

        #topBar h4 {
            color: green;
            margin-left: 32%;
            margin-top: 30px;
            margin-bottom: 10px;
            font-size: 50px;
        }

        big{
            color: green;
        }
        #welcome-referral{
            color: darkgreen;
        }
        body {
            background: url(cakeBackground.jpg);
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        .menu-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-bottom: 10px;
        }
        .menu-row {
            display: flex;
            justify-content: center;
            margin-bottom: 0px;
        }
        .menu-item {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 10px;
            padding: 15px;
            width: 140px;
            text-align: center;
        }
        .menu-item img {
            border-radius: 10%;
            width: 100%;
            height: auto;
        }
        .menu-item span {
            display: block;
            margin: 10px 0;
            font-size: 16px;
        }
        .menu-item button {
            background-color: green;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
            width: 105px;
        }
        .menu-item button:hover {
            background-color: darkgreen;
        }
        .quantity-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
            visibility: hidden;
            display: none;
        }
        .quantity-controls button {
            background-color: #ccc;
            border: none;
            padding: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 5px;
        }
        .quantity-controls button:hover {
            background-color: #bbb;
        }
        .quantity-controls input {
            width: 40px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 16px;
        }
        .cart-button {
            
            margin-bottom: 100px;
            width: 100%;
            background-color: orange;
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 18px;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
           
        }
        .cart-button:hover {
            background-color: darkorange;
        }
        .message {
            color: green;
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }
        .hidden {
            display: none;
        }
        .a{
            display:flex;
        }
        #name{
            width: 175px;
            padding: 12px 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        #dob{
            width: 175px;
            padding: 12px 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        #textAndInput{
            display: flex;
        }
        .nameRecordAndDobRecord{
            display: flex;
             justify-content: space-between;
        }
        #recordsListName{
            align-items: center;
            justify-content: center;
            align-content: center;
            width: 175px;
        }
        #recordsListDob{
            align-items: center;
            justify-content: center;
            align-content: center;
            width: 175px;
        }
        .allRecords{
            display: flex;
           justify-content: space-between;
        }



        
        @keyframes a {
    0%{ opacity: 1;}
    50%{ opacity: 0;}
    100%{ opacity: 1;}
  }

  @keyframes b {
    0%{ border-width: 5;}
    50%{ border-width: 0;}
    100%{ border-width: 5;}
  }

  #aDiv{
    padding-top: 20px;
    text-align: center;
    
  }

  #aDiv big{
    
    text-align: center;
    
    
  }

  #off{
    text-align: center;
   animation: a 0.70s infinite;
   padding-top: 25px;
  }

  #off big {
    
    text-align: center;
     font-size: 25px;
  }

  .slider_container {
  position: relative;
  width: 100%;
  height: 180px;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  overflow: hidden;
  margin-top: 10px;
}
.slider {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  animation: 30s cubic-bezier(1, 0.95, 0.565, 1) sliding infinite;
}
.slide {
  position: relative;
  min-width: 100%;
  height: 100%;
}
.slide img {
  width: 100%;
  height: 100%;
}

.slide.one {
  background: linear-gradient(180deg, white, lightgreen, darkgreen)
}
.slide.two {
  /* background: rgb(255, 64, 64); */
}
.slide.three {
  /* background: rgb(11, 173, 188);
 */}
.slide.four {
  /* background: rgb(11, 188, 14); */
}
.slide.five {
  /* background: rgb(173, 11, 188); */
}
@keyframes sliding {
  0% {
    transform: translateX(0%);
  }
  20% {
    transform: translateX(0%);
  }
  25% {
    transform: translateX(-100%);
  }
  45% {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(-200%);
  }
  70% {
    transform: translateX(-200%);
  }
  75% {
    transform: translateX(-300%);
  }
  95% {
    transform: translateX(-300%);
  }
  100% {
    transform: translateX(-400%);
  }
}

.sliderImage1{
  padding-left: 20px;
}
.sliderImage2{
  padding-right: 20px;
}
.sliderImageAll{
  padding-top: 30px;
  justify-content: space-between;
  display:flex;
}
  
    </style>
</head>
<body>
    
     <div style="display: flex; background-color: white; height: 70px; align-content: center; position: fixed; bottom: 0px; width: 100%; justify-content: space-between; " >
    <img onclick="goToWallet()" src="walletImage.png" alt="" style="height: 50px;width: 50;  margin-top: 10px;">
    <img onclick="goToCart()" src="cartImage.png" alt="" style="height: 50px;width: 50;  margin-top: 10px;">

</div> 
<div>
    <div id="topBar">
        <h4>eekh</h4>
    </div>

    <section class="slider_container">
        <section class="slider">
          <div class="slide one">
            
                   <div class="sliderImageAll" >
    
                   <div class="sliderImage1" >
                   <img class="myImage1" src="cake1.jpeg" alt="image" style="width:80px;  height: 80px; border-style: solid; border-width: 5; animation: b 1s infinite;">
                   </div>
                   <div id="off">
              <big><big><u><span>*Rs.100 off*</span></u></big></big>
                   </div>
                   <div class="sliderImage2" >
                   <img class="myImage2" src="cake1.jpeg" alt="image" style="width:80px;  height: 80px; border-style: solid; border-width: 5; animation: b 1s infinite;">
           </div>
           
          </div>
                   <div id="aDiv">
                     <big style="color: #fefefe;" >Please Fill the Below Feilds You will get</big>
                         </div>
          </div>
          <div class="slide two">
            <img src="coffeeSlider.png" alt="" />
            <span class="caption"> slide two </span>
          </div>
          <div class="slide three">
            <img src="cake14.jpg" alt="" />
            <span class="caption"> slide three </span>
          </div>
          <div class="slide four">
            <img src="cake17.jpg" alt="" />
            <span class="caption"> slide four </span>
          </div>
          <div class="slide four">
            <img src="cake26.jpg" alt="" />
            <span class="caption"> slide five </span>
          </div>
        </section>
      </section>
    
    
    
    
    
    
          <script>
            const images1 = ['cake1.jpeg','cake2.jpeg','cake3.jpeg', 'cake4.jpeg', 'cake5.jpeg']
            const images2 = ['cake2.jpeg','cake3.jpeg','cake4.jpeg', 'cake5.jpeg', 'cake1.jpeg']
              let currentIndex1 = 0;
              let currentIndex2 = 0;
    
              function changeImage(){
                const imgs1 = document.querySelectorAll('.myImage1');
                const imgs2 = document.querySelectorAll('.myImage2');
                currentIndex1 = (currentIndex1 + 1) % images1.length;
                currentIndex2 = (currentIndex2 + 1) % images2.length;
                imgs1.forEach(img => img.src = images1[currentIndex1]);
                imgs2.forEach(img => img.src = images2[currentIndex2]);
                
              }
    
              setInterval(changeImage, 1000)
          </script>
    


    <div class="container">
        <h1 id="welcome-message">Loading...</h1>
        

        <form id="info-form">
            <div class="textAndInput" >
            <input type="text" id="name" placeholder="Name" required>
            <input type="date" id="dob" required placeholder="Please Enter Date Of Birth">
            </div>
            <button type="submit">Submit</button>
        </form>
            <h4 id="welcome-referral">Loading...</h4>
        <div class="record">
            <div class="nameRecordAndDobRecord" >
           
            <h3 style="width: 175px;" class="nameRecord" >Name</h3>
            <h3 style="width: 175px;" class="dobRecord" >DOB</h3>
            
            </div>
            <div class="allRecords" >
            <div id="recordsListName">Loading...</div>
            
            <div id="recordsListDob">Loading...</div>
        </div>
    </div>
       


        <div id="message"></div>
        <hr>
        <p><u><b>Our Servings</b></u></p>
        <hr>
        <pre><b>1.  <a href="cake.html">Cake</a></b></pre>
        <pre><b>2.  <a href="pizza.html">Pizza</a></b></pre>
        <pre><b>3.  <a href="index.html">Ice Cream</a></b></pre>
        <pre><b>4.  <a href="index.html">Cold Coffee</a></b></pre>
    

    <hr>
   
    
    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeresetmodal">&times;</span>
            <h2>Reset Password</h2>
            <input type="text" id="reset-mobile" placeholder="Enter your registered mobile number" required>
            <button id="sendOtpButton">Send OTP</button>

            <div id="otpSection" style="display:none;">
                <input type="text" id="otp" placeholder="Enter OTP" required>
                <button id="verifyotp">Verify OTP</button>
            </div>

            <div id="newPasswordSection" style="display:none;">
                <input type="password" id="new-password" placeholder="Enter new password" required>
                <button id="resetpassword">Reset Password</button>
            </div>
        </div>
    </div>










    <div class="menu-container">
        <div class="a" >
        <!-- Row 1 -->
        <div class="menu-row">
            <div class="menu-item" id="item1">
                <img src="cake1.jpeg" alt="Cake 1 Pound">
                <span>Cake 1 Pound</span>
                <span style="color: green;">Rs.280</span>
                <div id="quantity-controls1" class="quantity-controls">
                    <button onclick="decreaseQuantity('quantity1')">-</button>
                    <input type="number" id="quantity1" value="1" min="1">
                    <button onclick="increaseQuantity('quantity1')">+</button>
                </div>
                <button onclick="handleAddToCart('Cake 1 Pound', 280, 'cake1.jpeg', 'quantity1')" id="add-to-cart1">Add to Cart</button>  <div id="message1" class="message hidden">Item added to cart</div>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="menu-row">
            <div class="menu-item" id="item2">
                <img src="cake2.jpeg" alt="Cake 2 Pounds">
                <span>Cake 2 Pounds</span>
                <span style="color: green;">Rs.560</span>
                <div id="quantity-controls2" class="quantity-controls">
                    <button onclick="decreaseQuantity('quantity2')">-</button>
                    <input type="number" id="quantity2" value="1" min="1">
                    <button onclick="increaseQuantity('quantity2')">+</button>
                </div>
                <button onclick="handleAddToCart('Cake 2 Pounds', 560, 'cake2.jpeg', 'quantity2')" id="add-to-cart2">Add to Cart</button> <div id="message2" class="message hidden">Item added to cart</div>
            </div>
        </div>
    </div>
    <div class="a" >
        <!-- Row 3 -->
        <div class="menu-row">
            <div class="menu-item" id="item3">
                <img src="cake3.jpeg" alt="Cake 3 Pounds">
                <span>Cake 3 Pounds</span>
                <span style="color: green;">Rs.840</span>
                <div id="quantity-controls3" class="quantity-controls">
                    <button onclick="decreaseQuantity('quantity3')">-</button>
                    <input type="number" id="quantity3" value="1" min="1">
                    <button onclick="increaseQuantity('quantity3')">+</button>
                </div>
                <button onclick="handleAddToCart('Cake 3 Pounds', 840, 'cake3.jpeg', 'quantity3')" id="add-to-cart3">Add to Cart</button> <div id="message3" class="message hidden">Item added to cart</div>
            </div>
        </div>

        <!-- Row 4 -->
        <div class="menu-row">
            <div class="menu-item" id="item4">
                <img src="cake4.jpeg" alt="Cake 4 Pounds">
                <span>Cake 4 Pounds</span>
                <span style="color: green;">Rs.1120</span>
                <div id="quantity-controls4" class="quantity-controls">
                    <button onclick="decreaseQuantity('quantity4')">-</button>
                    <input type="number" id="quantity4" value="1" min="1">
                    <button onclick="increaseQuantity('quantity4')">+</button>
                </div>
                <button onclick="handleAddToCart('Cake 4 Pounds', 1120, 'cake4.jpeg', 'quantity4')" id="add-to-cart4">Add to Cart</button>  <div id="message4" class="message hidden">Item added to cart</div>
            </div>
        </div>
    </div>  
    </div>

    <button class="cart-button" onclick="goToCart()">Go to Cart</button>

</div>


</div>

    <!-- Button to open the Reset Password Modal -->
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
        import { getFirestore, doc, getDoc, addDoc, collection, getDocs, updateDoc, setDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
        import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDjpg5dNL6R44dPpoDQabNaT8tLVmVWTQQ",
            authDomain: "eekh-website.firebaseapp.com",
            databaseURL: "https://eekh-website-default-rtdb.firebaseio.com",
            projectId: "eekh-website",
            storageBucket: "eekh-website.appspot.com",
            messagingSenderId: "276234231567",
            appId: "1:276234231567:web:1509267f60d97a83cea87a",
            measurementId: "G-QX5HCKXMDK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        
        // Get query parameters
        const queryParams = new URLSearchParams(window.location.search);
        const mobile = queryParams.get('mobile');
        
        // function go(){
        //     window.location.href = `Menu.html?mobile=${encodeURIComponent(mobile)}`;
        // }
        // window.go = go;
        if (mobile) {
            const userRef = doc(db, 'users', mobile);
            const docSnap = await getDoc(userRef);

            const welcomeMessage = document.getElementById('welcome-message');
            const welcomereferral = document.getElementById('welcome-referral');
            const nameInput = document.getElementById('name');
            const dobInput = document.getElementById('dob');
            const recordsListName = document.getElementById('recordsListName');
            const recordsListDob = document.getElementById('recordsListDob');

            if (docSnap.exists()) {
                const userData = docSnap.data();
                const userName = userData.name;
                const userReferral = userData.referralPhoneNumber;

                welcomeMessage.textContent = `Welcome, ${userName}!`;
                welcomereferral.textContent = `Referred By, ${userReferral}!`;
            } else {
                welcomeMessage.textContent = 'User not found!';
            }

            // Handle form submission
            const infoForm = document.getElementById('info-form');
            infoForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = nameInput.value;
                const dob = dobInput.value;

                try {
                    // Add new record to Firestore under a subcollection for the user
                    const docRef = await addDoc(collection(db, 'users', mobile, 'records'), {
                        name: name,
                        dob: dob
                    });

                    console.log('Document written with ID: ', docRef.id);

                    // Refresh the records list
                    fetchRecords();
                } catch (e) {
                    console.error('Error adding document: ', e);
                }
            });

            // Function to fetch and display all records
            async function fetchRecords() {
                recordsListName.innerHTML = 'Loading...';
                recordsListDob.innerHTML = 'Loading...'; // Show loading text

                try {
                    const snapshot = await getDocs(collection(db, 'users', mobile, 'records'));
                    recordsListName.innerHTML = ''; // Clear loading text
                    recordsListDob.innerHTML = '';

                    if (snapshot.empty) {
                        recordsListName.textContent = 'No records found.';
                        recordsListDob.textContent = 'No records found.';
                    } else {
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            const lineBreak = document.createElement('br');
                            const recordElementName = document.createElement('div');
                            const recordElementDob = document.createElement('div');
                            recordElementName.textContent = `${data.name}`;
                            recordElementDob.innerHTML = `${data.dob}`;
                            recordsListName.appendChild(recordElementName);
                            recordsListDob.appendChild(recordElementDob);
                            
                        });
                    }
                } catch (e) {
                    console.error('Error fetching records: ', e);
                    recordsListName.textContent = 'Failed to load records.';
                    recordsListDob.textContent = 'Failed to load records.';
                }
            }

            // Fetch and display records on page load
            fetchRecords();
        } else {
            alert('User not found.');
        }














        async function loadCartData() {
    const cartRef = collection(db, 'users', mobile, 'cart');
    const querySnapshot = await getDocs(cartRef);
    
    querySnapshot.forEach((doc) => {
        const data = doc.data();
        const itemId = getItemIdByName(data.itemName);
        
        if (itemId) {
            // Update the quantity of the item in the UI based on the database
            const quantityInput = document.getElementById(`quantity${itemId}`);
            quantityInput.value = data.quantity;
            document.getElementById(`quantity-controls${itemId}`).style.visibility = 'visible';
            document.getElementById(`quantity-controls${itemId}`).style.display = 'flex';
            document.getElementById(`add-to-cart${itemId}`).classList.add('hidden');
        }
    });
}

function getItemIdByName(itemName) {
    const items = {
        'Cake 1 Pound': 1,
        'Cake 2 Pounds': 2,
        'Cake 3 Pounds': 3,
        'Cake 4 Pounds': 4
    };
    return items[itemName];
}

async function handleAddToCart(itemName, itemPrice, itemImage, quantityId) {
    // Set the quantity to 1 when adding a new item
    const quantity = 1;

    const cartRef = collection(db, 'users', mobile, 'cart');
    const querySnapshot = await getDocs(cartRef);

    let itemExists = false;

    // Check if the item already exists in the cart
    for (const doc of querySnapshot.docs) {
        const data = doc.data();
        if (data.itemName === itemName) {
            itemExists = true;
            await setDoc(doc.ref, {
                ...data,
                quantity: (parseInt(data.quantity) + 1).toString(),  // Increment the quantity by 1
                itemImage
            });
            break;
        }
    }

    // If the item does not exist, add it with quantity 1
    if (!itemExists) {
        await addDoc(cartRef, {
            itemName,
            itemPrice,
            quantity: quantity.toString(), // Set the initial quantity to 1
            itemImage
        });
    }

    // Update UI
    const itemId = getItemIdByName(itemName);
    document.getElementById(`add-to-cart${itemId}`).classList.add('hidden');
    document.getElementById(`quantity-controls${itemId}`).style.visibility = 'visible';
    document.getElementById(`quantity-controls${itemId}`).style.display = 'flex';
}



window.increaseQuantity = function (quantityId) {
    const input = document.getElementById(quantityId);
    input.value = parseInt(input.value) + 1;
    updateCartQuantity(quantityId, input.value);
};

window.decreaseQuantity = async function (quantityId) {
    const itemId = quantityId.slice(-1);
    const input = document.getElementById(quantityId);
    const newQuantity = parseInt(input.value) - 1;

    if (newQuantity > 0) {
        input.value = newQuantity;
        updateCartQuantity(quantityId, input.value);
    } else if (newQuantity === 0) {
        document.getElementById(`add-to-cart${itemId}`).classList.remove('hidden');
        document.getElementById(`quantity-controls${itemId}`).classList.add('hidden');
        document.getElementById(`quantity-controls${itemId}`).style.display = 'none';

        // Remove the item from the cart in Firestore
        const itemName = document.querySelector(`#item${itemId} span`).innerText;
        const cartRef = collection(db, 'users', mobile, 'cart');
        const querySnapshot = await getDocs(cartRef);

        for (const doc of querySnapshot.docs) {
            const data = doc.data();
            if (data.itemName === itemName) {
                await setDoc(doc.ref, {
                    ...data,
                    quantity: '0'
                });
                await deleteDoc(doc.ref); // Remove the document from the cart collection
                break;
            }
        }
    }
};

async function updateCartQuantity(quantityId, quantity) {
    const itemId = quantityId.slice(-1);
    const itemName = document.querySelector(`#item${itemId} span`).innerText;
    const itemImage = document.querySelector(`#item${itemId} img`).src;

    const cartRef = collection(db, 'users', mobile, 'cart');
    const querySnapshot = await getDocs(cartRef);

    let itemExists = false;

    for (const doc of querySnapshot.docs) {
        const data = doc.data();
        if (data.itemName === itemName) {
            itemExists = true;
            await setDoc(doc.ref, {
                ...data,
                quantity: quantity.toString(),
                itemImage
            });
            break;
        }
    }

    if (!itemExists) {
        console.error("Item not found in cart.");
    }
}

function goToCart() {
    window.location.href = `Cart.html?mobile=${mobile}`;
}
function goToWallet() {
    window.location.href = `Wallet.html?mobile=${mobile}`;
}
window.goToCart = goToCart;
window.goToWallet = goToWallet;
window.handleAddToCart = handleAddToCart;

// Load the cart data when the page loads
window.onload = loadCartData;


    </script>
</body>
</html>






























